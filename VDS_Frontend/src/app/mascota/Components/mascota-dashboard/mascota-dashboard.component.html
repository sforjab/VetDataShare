<div class="dashboard-container">
  <!-- Spinner de carga -->
  <ng-container *ngIf="isLoading; else contenidoMascota">
    <mat-spinner></mat-spinner>
  </ng-container>

  <!-- Contenido de la mascota -->
  <ng-template #contenidoMascota>
    <h1>Panel de Mascota</h1>
    <h3>{{ mascota?.nombre }} ({{ mascota?.numChip }})</h3>
    
    <!-- Tabs para actividad reciente -->
    <div class="tabs-container">
      <mat-tab-group>
        <!-- Tab de Últimas Consultas -->
        <mat-tab label="Últimas Consultas">
          <div *ngIf="ultimasConsultas?.length; else noConsultas">
            <table mat-table [dataSource]="ultimasConsultas" class="mat-elevation-z8">
              <!-- Fecha -->
              <ng-container matColumnDef="fecha">
                <th mat-header-cell *matHeaderCellDef>Fecha</th>
                <td mat-cell *matCellDef="let consulta">{{ consulta.fechaConsulta | date: 'dd/MM/yyyy' }}</td>
              </ng-container>

              <!-- Motivo -->
              <ng-container matColumnDef="motivo">
                <th mat-header-cell *matHeaderCellDef>Motivo</th>
                <td mat-cell *matCellDef="let consulta">{{ consulta.motivo }}</td>
              </ng-container>

              <!-- Acciones -->
              <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                <td mat-cell *matCellDef="let consulta">
                  <button mat-icon-button color="primary" (click)="verDetalleConsulta(consulta.id)">
                    <mat-icon>remove_red_eye</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="['fecha', 'motivo', 'acciones']"></tr>
              <tr mat-row *matRowDef="let row; columns: ['fecha', 'motivo', 'acciones']"></tr>
            </table>
          </div>
          <ng-template #noConsultas>
            <p class="placeholder">No se encontraron consultas recientes para esta mascota.</p>
          </ng-template>
        </mat-tab>

        <!-- Tab de Últimas Pruebas -->
        <mat-tab label="Últimas Pruebas">
          <div *ngIf="ultimasPruebas?.length; else noPruebas">
            <table mat-table [dataSource]="ultimasPruebas" class="mat-elevation-z8">
              <!-- Fecha -->
              <ng-container matColumnDef="fecha">
                <th mat-header-cell *matHeaderCellDef>Fecha</th>
                <td mat-cell *matCellDef="let prueba">{{ prueba.fecha | date: 'dd/MM/yyyy' }}</td>
              </ng-container>

              <!-- Tipo -->
              <ng-container matColumnDef="tipo">
                <th mat-header-cell *matHeaderCellDef>Tipo</th>
                <td mat-cell *matCellDef="let prueba">{{ prueba.tipo }}</td>
              </ng-container>

              <!-- Acciones -->
              <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                <td mat-cell *matCellDef="let prueba">
                  <button mat-icon-button color="primary" (click)="verDetallePrueba(prueba.id)">
                    <mat-icon>remove_red_eye</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="['fecha', 'tipo', 'acciones']"></tr>
              <tr mat-row *matRowDef="let row; columns: ['fecha', 'tipo', 'acciones']"></tr>
            </table>
          </div>
          <ng-template #noPruebas>
            <p class="placeholder">No se encontraron pruebas recientes para esta mascota.</p>
          </ng-template>
        </mat-tab>

        <!-- Tab de Últimas Vacunas -->
        <mat-tab label="Últimas Vacunas">
          <div *ngIf="ultimasVacunas?.length; else noVacunas">
            <table mat-table [dataSource]="ultimasVacunas" class="mat-elevation-z8">
              <!-- Fecha -->
              <ng-container matColumnDef="fecha">
                <th mat-header-cell *matHeaderCellDef>Fecha</th>
                <td mat-cell *matCellDef="let vacuna">{{ vacuna.fecha | date: 'dd/MM/yyyy' }}</td>
              </ng-container>

              <!-- Nombre -->
              <ng-container matColumnDef="nombre">
                <th mat-header-cell *matHeaderCellDef>Nombre</th>
                <td mat-cell *matCellDef="let vacuna">{{ vacuna.nombre }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="['fecha', 'nombre']"></tr>
              <tr mat-row *matRowDef="let row; columns: ['fecha', 'nombre'];"></tr>
            </table>
          </div>
          <ng-template #noVacunas>
            <p class="placeholder">No se encontraron vacunas recientes para esta mascota.</p>
          </ng-template>
        </mat-tab>
      </mat-tab-group>
    </div>
    <div
      class="dashboard-buttons"
      [ngClass]="{'cliente-layout': rolUsuario === 'CLIENTE', 'default-layout': rolUsuario !== 'CLIENTE'}"
    >
      <div class="dashboard-button" (click)="navegarDetalle()">
        <i class="fa-solid fa-circle-info"></i>
        <span>Consultar datos</span>
      </div>
      <div class="dashboard-button" (click)="navegarConsultas()">
        <i class="fa-solid fa-notes-medical"></i>
        <span>Histórico de consultas</span>
      </div>
      <div class="dashboard-button" (click)="navegarPruebas()">
        <i class="fa-solid fa-vial"></i>
        <span>Pruebas</span>
      </div>
      <div class="dashboard-button" (click)="navegarVacunas()">
        <i class="fa-solid fa-syringe"></i>
        <span>Vacunas</span>
      </div>
      <div
        class="dashboard-button"
        *ngIf="rolUsuario === 'CLIENTE'"
        (click)="navegarAccesoTemporal()"
      >
        <i class="fa-solid fa-hourglass-half"></i>
        <span>Generar Acceso Temporal</span>
      </div>
    </div>

    <!-- Botón Volver -->
    <button mat-raised-button class="button-secondary button-volver" (click)="volver()" *ngIf="rolUsuario !== 'TEMPORAL'">Volver</button>
  </ng-template>
</div>
